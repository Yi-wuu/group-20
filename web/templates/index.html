<html>
<head>

    <div style = "text-align: center;">dublin bike</div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script

src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAvBNXUTSTxrubQdbSTLWk01GbuAEoq2H0&sensor=false">
</script>

<script>

    var myCenter=new google.maps.LatLng(53.350140, -6.266155);

function initialize() {
    var mapProp = {
        center: new google.maps.LatLng(53.350140, -6.266155),
        zoom: 13,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

    var marker = new google.maps.Marker({
        position: myCenter,
    });
    $.getJSON("http://127.0.0.1:5000/stations", null, function (data) {
        showStationMarkers(data);
    });

    $.getJSON("http://127.0.0.1:5000/dynamicBike", null, function (data1) {
        showStationMarkers(data1);
    });


    function showStationMarkers(data) {
        let json = $.getJSON("http://127.0.0.1:5000/stations", null, function (data) {

            if ('stations' in data) {

                var stations = data.stations;

                console.log('stations', stations);
                for (var i = 0; i < stations.length; i++) {
                    var lat = stations[i].lat;
                    var lng = stations[i].lng;
    var infowindow = new google.maps.InfoWindow();
                    var stationsInfo =  stations[i].number + " " +stations[i].name;
                    // console.log(stationsInfo);
                    var station_number = stations[i].number;
                    var marker = new google.maps.Marker({
                        position: {
                            lat: lat,
                            lng: lng
                        },
                        map: map,
                        animation:google.maps.Animation.Drop, 
                        title: stations[i].name,
                        station_number: stations[i].number

                    });
                    marker.setMap(map);

                    google.maps.event.addListener(marker, 'click', (function (marker, i) {
                    var contentString = stationsInfo;
                    // console.log(stationsInfo);
                    var infowindow = new google.maps.InfoWindow({
                    content: contentString
                    })

                    return function () {
                    infowindow.open(map, marker);
                    }
                    })(marker, i));

                    // var contentinfo = station_number;
                    // // console.log(contentinfo);
                    //
                    // var infowindow = new google.maps.InfoWindow({
                    //         content: contentinfo
                    //     });
                    // google.maps.event.addListener(marker, 'click', function(){
                    //
                    //     console.log(contentinfo);
                    //
                    //
                    //     // infowindow.setContent(content);
                    //     //
                    //     infowindow.open(map, marker);
                    //
                    // });

                    // google.maps.event.addListener(marker, 'click', function(){
                    //     // infowindow.open();
                    //     infowindow.open(map, marker);
                    //     infowindow.setContent(`<div id="infowindow">${stationsInfo}</div>`);

    // });
                };

            }

        });


    }

}

google.maps.event.addDomListener(window, 'load', initialize);

</script>
</head>

<body>
<h1>Dublin Bike</h1>
<div id="googleMap" style="width:100%;height:500px; "></div>

</body>
</html>